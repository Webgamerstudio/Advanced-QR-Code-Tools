<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QR Code Generator</title>
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 0;
      margin: 0;
    }
    .container {
      background: #fff;
      padding: 20px;
      width: 100%;
      min-height: 100vh;
      overflow-y: auto;
      text-align: center;
      box-shadow: 0 0 20px rgba(0,0,0,0.1);
    }
    .tabs {
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-template-rows: auto auto;
      gap: 10px;
      justify-content: center;
      margin-bottom: 20px;
      padding: 10px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }
    .tab {
      padding: 8px 12px;
      background: #f8f9fa;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 500;
      transition: all 0.3s ease;
      color: #666;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
      text-decoration: none;
    }
    .tab.active {
      background: #667eea;
      color: white;
      box-shadow: 0 2px 10px rgba(102, 126, 234, 0.3);
    }
    .tab:hover {
      background: #e9ecef;
      transform: translateY(-1px);
    }
    .tab.active:hover {
      background: #667eea;
    }
    h2 {
      margin-bottom: 20px;
      color: #333;
      font-size: 24px;
    }
    .input-group {
      margin: 15px auto;
      text-align: left;
      max-width: 600px;
    }
    .input-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: #555;
      font-size: 14px;
    }
    input, textarea, button, select {
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: 2px solid #e0e0e0;
      font-size: 14px;
      transition: all 0.3s ease;
    }
    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 10px rgba(102, 126, 234, 0.3);
    }
    textarea {
      min-height: 100px;
      resize: vertical;
    }
    button {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border: none;
      cursor: pointer;
      font-size: 16px;
      font-weight: 500;
      margin: 10px 5px;
      padding: 12px 24px;
      border-radius: 10px;
    }
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    }
    button:disabled {
      background: #6c757d;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    button.secondary {
      background: #6c757d;
    }
    button.secondary:hover {
      background: #5a6268;
      box-shadow: 0 8px 25px rgba(108, 117, 125, 0.4);
    }
    .qr-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin: 20px auto;
      max-width: 600px;
    }
    .qr-canvas-container {
      margin: 20px auto;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 12px;
      border: 2px dashed #dee2e6;
      max-width: 600px;
    }
    .qr-display {
      max-width: 100%;
      height: auto;
      display: block;
      margin: 0 auto;
      border-radius: 8px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    .quick-actions {
      display: flex;
      justify-content: center;
      margin: 15px auto;
      flex-wrap: wrap;
      gap: 10px;
      max-width: 600px;
    }
    .quick-btn {
      background: #e9ecef;
      color: #495057;
      border: 1px solid #dee2e6;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      flex: 1;
      min-width: 80px;
    }
    .quick-btn:hover {
      background: #667eea;
      color: white;
      transform: translateY(-1px);
    }
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #28a745;
      color: white;
      padding: 15px 25px;
      border-radius: 8px;
      display: none;
      z-index: 1000;
      animation: slideIn 0.3s ease;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
    }
    .notification.error {
      background: #dc3545;
    }
    .notification.loading {
      background: #007bff;
    }
    .notification.info {
      background: #17a2b8;
    }
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid #f3f3f3;
      border-top: 2px solid #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-right: 10px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    @media (max-width: 600px) {
      .container {
        padding: 10px;
      }
      .tab {
        padding: 6px 10px;
        font-size: 10px;
      }
      .qr-options {
        grid-template-columns: 1fr;
      }
      .input-group, .qr-canvas-container, .quick-actions {
        max-width: 100%;
        padding: 0 10px;
      }
      h2 {
        font-size: 20px;
      }
      button {
        font-size: 14px;
        padding: 10px 20px;
      }
      .quick-btn {
        font-size: 10px;
        padding: 6px 12px;
      }
    }
  </style>
</head>
<body>
  <div id="notification" class="notification"></div>
  
  <div class="container">
    <div class="tabs">
      <a href="generator.html" class="tab active" aria-label="QR Code Generator Tab">üîó Generator</a>
      <a href="Home.html" class="tab" aria-label="QR Code Scanner Tab">üì∑ Scanner</a>
      <a href="upload.html" class="tab" aria-label="Upload QR Code Tab">üìÇ Upload</a>
      <a href="Home.html#history" class="tab" aria-label="QR Code History Tab">üìä History</a>
    </div>

    <h2>üîó QR Code Generator</h2>
    <div class="quick-actions">
      <button class="quick-btn" onclick="setQRType('url')">üåê URL</button>
      <button class="quick-btn" onclick="setQRType('text')">üìù Text</button>
      <button class="quick-btn" onclick="setQRType('email')">üìß Email</button>
      <button class="quick-btn" onclick="setQRType('phone')">üìû Phone</button>
      <button class="quick-btn" onclick="setQRType('wifi')">üì∂ WiFi</button>
    </div>
    <div class="input-group">
      <label for="qrText">Enter content:</label>
      <textarea id="qrText" placeholder="Enter text, URL, email, phone, or WiFi credentials"></textarea>
    </div>
    <div class="qr-options">
      <div class="input-group">
        <label for="qrSize">Size:</label>
        <select id="qrSize">
          <option value="200">Small (200px)</option>
          <option value="300" selected>Medium (300px)</option>
          <option value="400">Large (400px)</option>
          <option value="500">Extra Large (500px)</option>
        </select>
      </div>
      <div class="input-group">
        <label for="qrColor">Color:</label>
        <input type="color" id="qrColor" value="#000000">
      </div>
      <div class="input-group">
        <label for="qrBgColor">Background:</label>
        <input type="color" id="qrBgColor" value="#ffffff">
      </div>
      <div class="input-group">
        <label for="qrErrorLevel">Error Correction:</label>
        <select id="qrErrorLevel">
          <option value="L">Low (7%)</option>
          <option value="M" selected>Medium (15%)</option>
          <option value="Q">Quartile (25%)</option>
          <option value="H">High (30%)</option>
        </select>
      </div>
    </div>
    <button onclick="generateQR()" id="generateBtn">üîÑ Generate QR Code</button>
    <div class="qr-canvas-container">
      <div id="qrDisplay" style="display: none;"></div>
      <div id="qrPlaceholder" style="color: #666; padding: 40px; font-size: 18px;">
        <div>üì±</div>
        <div style="margin-top: 10px;">QR Code will appear here</div>
        <div style="font-size: 14px; color: #999; margin-top: 5px;">Enter content and click Generate</div>
      </div>
    </div>
    <div style="display: none;" id="downloadSection">
      <button onclick="downloadQR()">üíæ Download PNG</button>
      <button class="secondary" onclick="copyQRText()">üìã Copy Text</button>
      <button class="secondary" onclick="shareQR()">üì§ Share</button>
    </div>
  </div>

  <script>
    let qrHistory = [];
    let isGenerating = false;
    let currentQRUrl = '';

    // Try to load from localStorage (fallback to memory storage)
    try {
      const stored = localStorage.getItem('qrHistory');
      if (stored) {
        qrHistory = JSON.parse(stored);
      }
    } catch (e) {
      console.log('localStorage not available, using memory storage');
    }

    function showNotification(message, type = 'success') {
      const notification = document.getElementById('notification');
      
      // Add spinner for loading notifications
      if (type === 'loading') {
        message = `<span class="loading-spinner"></span>${message}`;
      }
      
      notification.innerHTML = message;
      notification.className = 'notification ' + type;
      notification.style.display = 'block';
      
      // Auto-hide after delay (except for loading)
      if (type !== 'loading') {
        setTimeout(() => {
          notification.style.display = 'none';
        }, type === 'error' ? 5000 : 3000);
      }
    }

    function hideNotification() {
      document.getElementById('notification').style.display = 'none';
    }

    function setQRType(type) {
      const qrText = document.getElementById('qrText');
      switch(type) {
        case 'url':
          qrText.value = 'https://';
          qrText.placeholder = 'Enter URL (e.g., https://example.com)';
          break;
        case 'email':
          qrText.value = 'mailto:';
          qrText.placeholder = 'Enter email (e.g., mailto:example@email.com)';
          break;
        case 'phone':
          qrText.value = 'tel:';
          qrText.placeholder = 'Enter phone (e.g., tel:+1234567890)';
          break;
        case 'wifi':
          qrText.value = 'WIFI:T:WPA;S:NetworkName;P:Password;;';
          qrText.placeholder = 'WiFi format: WIFI:T:WPA;S:NetworkName;P:Password;;';
          break;
        default:
          qrText.value = '';
          qrText.placeholder = 'Enter any text';
      }
      qrText.focus();
      qrText.setSelectionRange(qrText.value.length, qrText.value.length);
    }

    async function generateQR() {
      if (isGenerating) return;
      
      const text = document.getElementById('qrText').value.trim();
      const qrDisplay = document.getElementById('qrDisplay');
      const placeholder = document.getElementById('qrPlaceholder');
      const downloadSection = document.getElementById('downloadSection');
      const generateBtn = document.getElementById('generateBtn');

      if (!text) {
        showNotification('Please enter some content to generate a QR code.', 'error');
        return;
      }

      // Validate inputs
      const size = parseInt(document.getElementById('qrSize').value);
      const colorDark = document.getElementById('qrColor').value;
      const colorLight = document.getElementById('qrBgColor').value;
      const errorLevel = document.getElementById('qrErrorLevel').value;

      if (!size || size < 100 || size > 1000) {
        showNotification('Invalid QR code size selected.', 'error');
        return;
      }

      // Show loading state
      isGenerating = true;
      generateBtn.innerHTML = '<span class="loading-spinner"></span>Generating...';
      generateBtn.disabled = true;
      showNotification('Generating your QR code...', 'loading');

      try {
        // Generate QR code using reliable API
        const qrUrl = await generateQRWithAPI(text, size, colorDark, colorLight, errorLevel);
        
        // Create image element
        const img = document.createElement('img');
        img.className = 'qr-display';
        img.alt = 'Generated QR Code';
        
        // Set up image load handlers
        img.onload = function() {
          // Success - display QR code
          qrDisplay.innerHTML = '';
          qrDisplay.appendChild(img);
          placeholder.style.display = 'none';
          qrDisplay.style.display = 'block';
          downloadSection.style.display = 'block';
          
          // Store current QR URL for download
          currentQRUrl = qrUrl;
          
          // Add to history
          addToHistory('generated', text, 'Generated QR Code');
          
          hideNotification();
          showNotification('üéâ QR Code generated successfully!');
        };

        img.onerror = function() {
          throw new Error('Failed to load QR code image');
        };

        // Load the QR code
        img.src = qrUrl;

      } catch (err) {
        console.error('QR Generation failed:', err);
        showNotification('Failed to generate QR code. Please check your internet connection and try again.', 'error');
        
        // Reset display
        placeholder.style.display = 'block';
        qrDisplay.style.display = 'none';
        downloadSection.style.display = 'none';
        
      } finally {
        // Reset loading state
        isGenerating = false;
        generateBtn.innerHTML = 'üîÑ Generate QR Code';
        generateBtn.disabled = false;
      }
    }

    async function generateQRWithAPI(text, size, colorDark, colorLight, errorLevel) {
      // Clean colors (remove # if present)
      const color = colorDark.replace('#', '');
      const bgcolor = colorLight.replace('#', '');
      
      // Build API URL
      const baseUrl = 'https://api.qrserver.com/v1/create-qr-code/';
      const params = new URLSearchParams({
        data: text,
        size: `${size}x${size}`,
        color: color,
        bgcolor: bgcolor,
        format: 'png',
        ecc: errorLevel,
        margin: 10
      });
      
      const qrUrl = baseUrl + '?' + params.toString();
      
      // Test if the URL is accessible
      return new Promise((resolve, reject) => {
        const testImg = new Image();
        testImg.onload = () => resolve(qrUrl);
        testImg.onerror = () => reject(new Error('API service unavailable'));
        testImg.src = qrUrl;
      });
    }

    async function downloadQR() {
      if (!currentQRUrl) {
        showNotification('No QR code to download. Please generate one first.', 'error');
        return;
      }

      try {
        showNotification('Preparing download...', 'loading');
        
        // Fetch the image
        const response = await fetch(currentQRUrl);
        const blob = await response.blob();
        
        // Create download link
        const url = window.URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `qrcode-${Date.now()}.png`;
        
        // Trigger download
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        // Clean up
        window.URL.revokeObjectURL(url);
        
        hideNotification();
        showNotification('üì• QR Code downloaded successfully!');
        
      } catch (err) {
        console.error('Download failed:', err);
        
        // Fallback: open in new tab
        window.open(currentQRUrl, '_blank');
        hideNotification();
        showNotification('QR code opened in new tab. Right-click to save.', 'info');
      }
    }

    function copyQRText() {
      const text = document.getElementById('qrText').value.trim();
      if (!text) {
        showNotification('No text to copy. Please enter some content first.', 'error');
        return;
      }
      
      copyToClipboard(text, 'üìã QR code content copied to clipboard!');
    }

    function shareQR() {
      const text = document.getElementById('qrText').value.trim();
      
      if (!currentQRUrl) {
        showNotification('No QR code to share. Please generate one first.', 'error');
        return;
      }

      // Check if Web Share API is available
      if (navigator.share) {
        navigator.share({
          title: 'QR Code',
          text: 'Check out this QR code: ' + text,
          url: currentQRUrl
        }).then(() => {
          showNotification('üì§ QR code shared successfully!');
        }).catch((err) => {
          console.error('Share failed:', err);
          copyToClipboard(text, 'üìã QR code content copied for sharing!');
        });
      } else {
        // Fallback: copy content
        copyToClipboard(text, 'üìã QR code content copied for sharing!');
      }
    }

    function copyToClipboard(text, successMessage) {
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text).then(() => {
          showNotification(successMessage);
        }).catch(() => {
          fallbackCopy(text, successMessage);
        });
      } else {
        fallbackCopy(text, successMessage);
      }
    }

    function fallbackCopy(text, successMessage) {
      const textArea = document.createElement('textarea');
      textArea.value = text;
      textArea.style.position = 'fixed';
      textArea.style.opacity = '0';
      textArea.style.left = '-999999px';
      document.body.appendChild(textArea);
      textArea.select();
      textArea.setSelectionRange(0, 99999); // For mobile devices
      
      try {
        const successful = document.execCommand('copy');
        if (successful) {
          showNotification(successMessage);
        } else {
          showNotification('Failed to copy text. Please copy manually.', 'error');
        }
      } catch (err) {
        showNotification('Failed to copy text. Please copy manually.', 'error');
      }
      
      document.body.removeChild(textArea);
    }

    function addToHistory(type, content, method) {
      try {
        const historyItem = {
          id: Date.now(),
          type: type,
          content: content.length > 100 ? content.substring(0, 100) + '...' : content,
          fullContent: content,
          method: method,
          timestamp: new Date().toLocaleString(),
          qrUrl: currentQRUrl
        };
        
        qrHistory.unshift(historyItem);
        if (qrHistory.length > 50) {
          qrHistory = qrHistory.slice(0, 50);
        }
        
        // Try to save to localStorage
        try {
          localStorage.setItem('qrHistory', JSON.stringify(qrHistory));
        } catch (e) {
          console.log('Could not save to localStorage');
        }
      } catch (err) {
        console.error('Error adding to history:', err);
      }
    }

    // Keyboard shortcuts
    document.getElementById('qrText').addEventListener('keydown', function(e) {
      if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
        e.preventDefault();
        generateQR();
      }
    });

    // Auto-resize textarea
    document.getElementById('qrText').addEventListener('input', function() {
      this.style.height = 'auto';
      this.style.height = Math.min(this.scrollHeight, 200) + 'px';
    });

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      // Set focus on text area
      document.getElementById('qrText').focus();
      
      // Show ready message
      showNotification('QR Generator ready! Enter content to get started.', 'info');
    });
  </script>
</body>
</html>