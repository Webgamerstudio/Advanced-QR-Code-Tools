<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QR Code Generator</title>
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 0;
      margin: 0;
    }
    .container {
      background: #fff;
      padding: 20px;
      width: 100%;
      min-height: 100vh;
      overflow-y: auto;
      text-align: center;
      box-shadow: 0 0 20px rgba(0,0,0,0.1);
    }
    .tabs {
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-template-rows: auto auto;
      gap: 10px;
      justify-content: center;
      margin-bottom: 20px;
      padding: 10px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }
    .tab {
      padding: 8px 12px;
      background: #f8f9fa;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 500;
      transition: all 0.3s ease;
      color: #666;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
    }
    .tab.active {
      background: #667eea;
      color: white;
      box-shadow: 0 2px 10px rgba(102, 126, 234, 0.3);
    }
    .tab:hover {
      background: #e9ecef;
      transform: translateY(-1px);
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
      animation: fadeIn 0.5s ease;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    h2 {
      margin-bottom: 20px;
      color: #333;
      font-size: 24px;
    }
    .input-group {
      margin: 15px auto;
      text-align: left;
      max-width: 600px;
    }
    .input-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: #555;
      font-size: 14px;
    }
    input, textarea, button, select {
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: 2px solid #e0e0e0;
      font-size: 14px;
      transition: all 0.3s ease;
    }
    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 10px rgba(102, 126, 234, 0.3);
    }
    textarea {
      min-height: 100px;
      resize: vertical;
    }
    button {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border: none;
      cursor: pointer;
      font-size: 16px;
      font-weight: 500;
      margin: 10px 5px;
      padding: 12px 24px;
      border-radius: 10px;
    }
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    }
    button.secondary {
      background: #6c757d;
    }
    button.secondary:hover {
      background: #5a6268;
      box-shadow: 0 8px 25px rgba(108, 117, 125, 0.4);
    }
    .qr-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin: 20px auto;
      max-width: 600px;
    }
    .qr-canvas-container {
      margin: 20px auto;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 12px;
      border: 2px dashed #dee2e6;
      max-width: 600px;
    }
    #qrCanvas {
      max-width: 100%;
      height: auto;
      display: block;
      margin: 0 auto;
    }
    .quick-actions {
      display: flex;
      justify-content: center;
      margin: 15px auto;
      flex-wrap: wrap;
      gap: 10px;
      max-width: 600px;
    }
    .quick-btn {
      background: #e9ecef;
      color: #495057;
      border: 1px solid #dee2e6;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      flex: 1;
      min-width: 80px;
    }
    .quick-btn:hover {
      background: #667eea;
      color: white;
      transform: translateY(-1px);
    }
    .history-list {
      max-width: 600px;
      margin: 20px auto;
      text-align: left;
    }
    .history-item {
      padding: 10px;
      border-bottom: 1px solid #dee2e6;
      font-size: 14px;
      color: #333;
    }
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      border: 0;
    }
    @media (max-width: 600px) {
      .container {
        padding: 10px;
      }
      .tab {
        padding: 6px 10px;
        font-size: 10px;
      }
      .qr-options {
        grid-template-columns: 1fr;
      }
      .input-group, .qr-canvas-container, .quick-actions {
        max-width: 100%;
        padding: 0 10px;
      }
      h2 {
        font-size: 20px;
      }
      button {
        font-size: 14px;
        padding: 10px 20px;
      }
      .quick-btn {
        font-size: 10px;
        padding: 6px 12px;
      }
    }
  </style>
  <script>
    // Initialize QRCode to prevent undefined errors
    window.QRCode = window.QRCode || {};
  </script>
  <script src="js/qrcode.min.js" 
          onerror="this.onerror=null; this.src='https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js';"></script>
</head>
<body>
  <div class="container">
    <div class="tabs">
      <button class="tab active" data-tab="generator" aria-label="QR Code Generator Tab">üîó Generator</button>
      <button class="tab" data-tab="scanner" aria-label="QR Code Scanner Tab">üì∑ Scanner</button>
      <button class="tab" data-tab="upload" aria-label="Upload QR Code Tab">üìÇ Upload</button>
      <button class="tab" data-tab="history" aria-label="QR Code History Tab">üìä History</button>
    </div>

    <div id="generator" class="tab-content active">
      <h2>üîó QR Code Generator</h2>
      <div class="quick-actions">
        <button class="quick-btn" onclick="setQRType('url')">üåê URL</button>
        <button class="quick-btn" onclick="setQRType('text')">üìù Text</button>
        <button class="quick-btn" onclick="setQRType('email')">üìß Email</button>
        <button class="quick-btn" onclick="setQRType('phone')">üìû Phone</button>
        <button class="quick-btn" onclick="setQRType('wifi')">üì∂ WiFi</button>
      </div>
      <div class="input-group">
        <label for="qrText">Enter content:</label>
        <textarea id="qrText" placeholder="Enter text, URL, email, phone, or WiFi credentials" aria-describedby="qrTextDesc"></textarea>
        <small id="qrTextDesc" class="sr-only">Enter the content you want to encode into a QR code, such as a URL, text, email, phone number, or WiFi credentials.</small>
      </div>
      <div class="qr-options">
        <div class="input-group">
          <label for="qrSize">Size:</label>
          <select id="qrSize" aria-label="Select QR code size">
            <option value="200">Small (200px)</option>
            <option value="300" selected>Medium (300px)</option>
            <option value="400">Large (400px)</option>
            <option value="500">Extra Large (500px)</option>
          </select>
        </div>
        <div class="input-group">
          <label for="qrColor">Color:</label>
          <input type="color" id="qrColor" value="#000000" aria-label="Select QR code foreground color">
        </div>
        <div class="input-group">
          <label for="qrBgColor">Background:</label>
          <input type="color" id="qrBgColor" value="#ffffff" aria-label="Select QR code background color">
        </div>
        <div class="input-group">
          <label for="qrErrorLevel">Error Correction:</label>
          <select id="qrErrorLevel" aria-label="Select QR code error correction level">
            <option value="L">Low (7%)</option>
            <option value="M" selected>Medium (15%)</option>
            <option value="Q">Quartile (25%)</option>
            <option value="H">High (30%)</option>
          </select>
        </div>
      </div>
      <button onclick="generateQR()" aria-label="Generate QR Code">üîÑ Generate QR Code</button>
      <div class="qr-canvas-container">
        <canvas id="qrCanvas" aria-label="Generated QR Code"></canvas>
        <div id="qrPlaceholder" style="color: #666; padding: 40px;">
          QR Code will appear here
        </div>
      </div>
      <div style="display: none;" id="downloadSection">
        <button onclick="downloadQR()" aria-label="Download QR Code as PNG">üíæ Download PNG</button>
        <button class="secondary" onclick="copyQRLink()" aria-label="Copy QR Code Data URL">üîó Copy Link</button>
      </div>
    </div>

    <div id="scanner" class="tab-content">
      <h2>üì∑ QR Code Scanner</h2>
      <p>Scanner functionality is not implemented yet. This section will allow scanning QR codes using a webcam or mobile camera.</p>
    </div>

    <div id="upload" class="tab-content">
      <h2>üìÇ Upload QR Code</h2>
      <p>Upload functionality is not implemented yet. This section will allow uploading a QR code image to decode its content.</p>
    </div>

    <div id="history" class="tab-content">
      <h2>üìä QR Code History</h2>
      <div class="history-list" id="historyList">
        <p>No history available yet.</p>
      </div>
    </div>
  </div>

  <script>
    let qrHistory = JSON.parse(localStorage.getItem('qrHistory')) || [];

    function showTab(tabName, element) {
      document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      document.getElementById(tabName).classList.add('active');
      element.classList.add('active');
      if (tabName === 'history') {
        displayHistory();
      }
    }

    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => showTab(tab.dataset.tab, tab));
    });

    function setQRType(type) {
      const qrText = document.getElementById('qrText');
      switch(type) {
        case 'url':
          qrText.value = 'https://';
          qrText.placeholder = 'Enter URL (e.g., https://example.com)';
          break;
        case 'email':
          qrText.value = 'mailto:';
          qrText.placeholder = 'Enter email (e.g., mailto:example@email.com)';
          break;
        case 'phone':
          qrText.value = 'tel:';
          qrText.placeholder = 'Enter phone (e.g., tel:+1234567890)';
          break;
        case 'wifi':
          qrText.value = 'WIFI:T:WPA;S:NetworkName;P:Password;;';
          qrText.placeholder = 'WiFi format: WIFI:T:WPA;S:NetworkName;P:Password;;';
          break;
        default:
          qrText.value = '';
          qrText.placeholder = 'Enter any text';
      }
      qrText.focus();
    }

    function generateQR() {
      const text = document.getElementById('qrText').value.trim();
      const canvas = document.getElementById('qrCanvas');
      const placeholder = document.getElementById('qrPlaceholder');
      const downloadSection = document.getElementById('downloadSection');

      if (!text) {
        alert('Please enter some content to generate a QR code.');
        return;
      }

      const size = parseInt(document.getElementById('qrSize').value);
      const colorDark = document.getElementById('qrColor').value;
      const colorLight = document.getElementById('qrBgColor').value;
      const errorCorrectionLevel = document.getElementById('qrErrorLevel').value;

      if (isNaN(size) || size < 100 || size > 1000) {
        alert('Invalid QR code size. Please select a size between 100px and 1000px.');
        return;
      }
      if (!/^#[0-9A-Fa-f]{6}$/.test(colorDark) || !/^#[0-9A-Fa-f]{6}$/.test(colorLight)) {
        alert('Invalid color format. Please select valid hex colors.');
        return;
      }
      if (!['L', 'M', 'Q', 'H'].includes(errorCorrectionLevel)) {
        alert('Invalid error correction level. Please select a valid option.');
        return;
      }

      if (typeof QRCode === 'undefined' || !QRCode.toCanvas) {
        alert('QR code library failed to load. Ensure js/qrcode.min.js is correctly placed or check your internet connection for the CDN fallback.');
        console.error('QRCode library is undefined or missing toCanvas method.');
        placeholder.style.display = 'block';
        canvas.style.display = 'none';
        downloadSection.style.display = 'none';
        return;
      }

      const options = {
        width: size,
        colorDark: colorDark,
        colorLight: colorLight,
        errorCorrectionLevel: errorCorrectionLevel
      };

      try {
        QRCode.toCanvas(canvas, text, options, function (error) {
          if (error) {
            console.error('QR Generation error:', error);
            alert('Error generating QR code: ' + error.message);
            placeholder.style.display = 'block';
            canvas.style.display = 'none';
            downloadSection.style.display = 'none';
          } else {
            placeholder.style.display = 'none';
            canvas.style.display = 'block';
            downloadSection.style.display = 'block';
            addToHistory('generated', text, 'Generated QR Code');
          }
        });
      } catch (err) {
        console.error('QR Generation failed:', err);
        alert('Failed to generate QR code: ' + (err.message || 'Unknown error'));
        placeholder.style.display = 'block';
        canvas.style.display = 'none';
        downloadSection.style.display = 'none';
      }
    }

    function downloadQR() {
      const canvas = document.getElementById('qrCanvas');
      const link = document.createElement('a');
      link.download = 'qrcode.png';
      link.href = canvas.toDataURL('image/png');
      link.click();
    }

    function copyQRLink() {
      const canvas = document.getElementById('qrCanvas');
      const dataURL = canvas.toDataURL('image/png');
      navigator.clipboard.writeText(dataURL).then(() => {
        alert('QR Code data URL copied to clipboard!');
      }).catch(err => {
        console.error('Copy failed:', err);
        alert('Failed to copy QR code data URL.');
      });
    }

    function addToHistory(type, content, method) {
      try {
        const historyItem = {
          id: Date.now(),
          type: type,
          content: content,
          method: method,
          timestamp: new Date().toLocaleString('en-US', { timeZone: 'Asia/Dhaka' })
        };
        qrHistory.unshift(historyItem);
        if (qrHistory.length > 50) qrHistory = qrHistory.slice(0, 50);
        try {
          localStorage.setItem('qrHistory', JSON.stringify(qrHistory));
        } catch (e) {
          if (e.name === 'QuotaExceededError') {
            alert('Storage limit reached. Clearing older history items.');
            qrHistory = qrHistory.slice(0, 10);
            localStorage.setItem('qrHistory', JSON.stringify(qrHistory));
          }
        }
      } catch (err) {
        console.error('Error adding to history:', err);
        alert('Failed to save history.');
      }
    }

    function displayHistory() {
      const historyList = document.getElementById('historyList');
      historyList.innerHTML = '';
      if (qrHistory.length === 0) {
        historyList.innerHTML = '<p>No history available yet.</p>';
        return;
      }
      qrHistory.forEach(item => {
        const div = document.createElement('div');
        div.className = 'history-item';
        div.innerHTML = `
          <strong>${item.method}</strong> (${item.type})<br>
          Content: ${item.content}<br>
          Time: ${item.timestamp}
        `;
        historyList.appendChild(div);
      });
    }

    // Initialize history on page load if history tab is active
    if (document.querySelector('.tab.active').dataset.tab === 'history') {
      displayHistory();
    }

    // Check if QRCode library loaded
    window.addEventListener('load', () => {
      if (typeof QRCode === 'undefined' || !QRCode.toCanvas) {
        console.error('QRCode library failed to load. Ensure js/qrcode.min.js is correctly placed or check your internet connection for the CDN fallback.');
        alert('QR code functionality is unavailable. Please ensure js/qrcode.min.js is correctly placed in the js folder or check your internet connection for the CDN fallback.');
      }
    });
  </script>
</body>
</html>